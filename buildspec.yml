version: 0.2

phases:
  install:
    runtime-versions:
      ruby: 2.7
    commands:
      - echo $RUBY_27_VERSION
#      - echo $GEM_HOME
#      - rbenv global $RUBY_27_VERSION && rbenv rehash
#      - export PATH="$HOME/.rbenv/bin:$PATH"
#      - eval "$(rbenv init -)"
      - gem environment
      - gem install bundler --no-document
      - bundle config set --local with 'test'
      - bundle install -j 8
      - bundle info rspec
#  pre_build:
#    commands:
#      - bundle info rspec
  build:
    commands:
      - bundle exec rspec spec --format RspecJunitFormatter --out spec/report.xml
#  post_build:
#    commands:
#      - echo Build completed on `date`

reports:
  rspec_reports:
    files:
      - report.xml
    base-directory: spec
    file-format: JUNITXML

cache:
  paths:
    - '/root/.rbenv/versions/2.7.2/lib/ruby/gems/2.7.0/**/*'
